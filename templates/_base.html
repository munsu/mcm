{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>MCM</title>

        <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
        <link href="{% static 'css/datatables.min.css' %}" rel="stylesheet">

    </head>

    <body>
        <header>
            <ul class="nav nav-pills">
                <li>
                    <a class="btn btn-link" href="{% url 'home' %}">Home</a>
                </li>
                <li>
                    <a type="button" class="btn btn-link" data-toggle="modal" data-target="#send-sms">
                      Send SMS
                    </a>
                </li>
                <li>
                    <a class="btn btn-link" href="{% url 'home' %}">Create Appointment</a>
                </li>
                <li>
                    <a class="btn btn-link" href="{% url 'home' %}">Manage Protocols</a>
                </li>
                <li>
                    <a class="btn btn-link" href="{% url 'home' %}">Upload CSV</a>
                </li>
                <li class="pull-right"><a href="{% url 'logout' %}">Hi, {{ request.user }}. Logout?</a></li>
            </ul>
        </header>
        <div class="container">
            {% block content %}
            {% endblock content %}
        </div>
        <!-- MODALS -->

        <!-- SEND SMS MODAL -->
        <div class="modal fade" id="send-sms" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Send SMS</h4>
              </div>
              <form id="send-sms-form" method="post" action="#">
              <div class="modal-body">
                  {% csrf_token %}
                  <div class="form-group">
                    <label for="inputPhone">Phone Number</label>
                    <input type="text" class="form-control" id="inputPhone" name="phone" placeholder="7320002923">
                  </div>
                  <div class="form-group">
                    <label for="inputText">Text Message</label>
                    <br />
                    <button id="inquiry-btn" class="btn btn-default">Inquiry</button>&nbsp;<button id="reschedule-btn" type="submit" class="btn btn-default">Reschedule</button><br />
                    <textarea class="form-control" rows="8" id="inputText" name="body" placeholder="MCM"></textarea>
                    <p class="help-block">Please avoid words that may be classified as <abbr data-toggle="tooltip" title="Some tooltip text!">Protected Health Information</abbr>. Use the templates provided where you can.</p>
                  </div>
                  <!-- <button type="submit" class="btn btn-default">Send SMS</button> -->
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Send SMS</button>
              </div>
              </form>
            </div>
          </div>
        </div>
        <!-- END SMS MODAL -->
    </body>
    {% block jscript %}
        <script type="text/javascript" src="{% static 'js/jquery-3.1.1.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/datatables.min.js' %}"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.bundle.min.js"></script>
        <script type="text/javascript">
            $("#inquiry-btn").click(function(e) {
                e.preventDefault();
                var company_name = "MCM";
                var datetime = "Mon 03/14/2016 at 8:00am";
                var place = "21 Jump Street";
                var phone_number = "212-241-0999";
                var spiel1 = "Reply OK to confirm";
                var spiel2 = "Reply NO to cancel";
                var spiel3 = "Reply STOP to Opt-out";
                var disclaimer = "Msg&data rates may apply";
                var msg = [company_name, datetime, place, phone_number, spiel1, spiel2, spiel3, disclaimer];
                console.log(msg.join('\n').length)
                $("#inputText").text(msg.join('\n'));
            });
            $("#reschedule-btn").click(function(e) {
                e.preventDefault();
                var company_name = "MCM";
                var concern = "Your appointment will be cancelled. Reschedule?";
                var spiel1 = "Reply YES to be connected to your doctor's office";
                var spiel2 = "Reply STOP to Opt-out";
                var disclaimer = "Msg&data rates may apply";
                var msg = [company_name, concern, spiel1, spiel2, disclaimer];
                console.log(msg.join('\n').length)
                $("#inputText").text(msg.join('\n'));
            });
            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });
            $("#send-sms-form").submit(function(e) {
                e.preventDefault();
                $.ajax({
                  url: "{% url 'appointments:send_sms' %}",
                  data: $(this).serialize(),
                  type: "POST",
                  success: function(data, textStatus, jqXHR) {
                      location.reload(); //todo
                      alert(data);
                  },
                  error: function(jqXHR, textStatus, errorThrown) {
                      console.log(textStatus + " " + errorThrown)
                      alert(errorThrown);
                  }
                });
            });
        </script>
    {% endblock jscript %}
    {% block extrajs %}
    {% endblock extrajs %}
</html>